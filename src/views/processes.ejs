<%- include('layout/header', { title: 'Processes' }) %>

<div class="grid grid-cols-1 gap-6">
    <!-- Process Summary -->
    <div class="bg-gray-800 p-6 rounded-lg">
        <h2 class="text-xl font-semibold mb-4">Process Summary</h2>
        <div id="processSummary" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </div>

    <!-- Top Processes -->
    <div class="bg-gray-800 p-6 rounded-lg">
        <h2 class="text-xl font-semibold mb-4">Top Processes</h2>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="text-left">
                        <th class="p-2">PID</th>
                        <th class="p-2">Name</th>
                        <th class="p-2">CPU %</th>
                        <th class="p-2">Memory %</th>
                        <th class="p-2">Command</th>
                    </tr>
                </thead>
                <tbody id="processTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const socket = io();

socket.on('processStats', (stats) => {
    // Process Summary
    const summaryHtml = `
        <div class="bg-gray-700 p-4 rounded-lg text-center">
            <div class="text-2xl font-bold">${stats.all}</div>
            <div class="text-gray-300">Total</div>
        </div>
        <div class="bg-gray-700 p-4 rounded-lg text-center">
            <div class="text-2xl font-bold">${stats.running}</div>
            <div class="text-gray-300">Running</div>
        </div>
        <div class="bg-gray-700 p-4 rounded-lg text-center">
            <div class="text-2xl font-bold">${stats.sleeping}</div>
            <div class="text-gray-300">Sleeping</div>
        </div>
        <div class="bg-gray-700 p-4 rounded-lg text-center">
            <div class="text-2xl font-bold">${stats.blocked}</div>
            <div class="text-gray-300">Blocked</div>
        </div>
    `;
    document.getElementById('processSummary').innerHTML = summaryHtml;

    // Process Table
    const tableHtml = stats.list.map(proc => `
        <tr class="border-t border-gray-700">
            <td class="p-2">${proc.pid}</td>
            <td class="p-2">${proc.name}</td>
            <td class="p-2">${proc.cpu.toFixed(1)}%</td>
            <td class="p-2">${proc.mem.toFixed(1)}%</td>
            <td class="p-2 truncate max-w-xs">${proc.command}</td>
        </tr>
    `).join('');
    document.getElementById('processTable').innerHTML = tableHtml;
});
</script>

<%- include('layout/footer') %>